watch_file flake.nix
watch_file flake.lock
mkdir -p "$(direnv_layout_dir)"
eval "$(nix print-dev-env --profile "$(direnv_layout_dir)/flake-profile")"

if vault lookup token &> /dev/null; then
  NOMAD_TOKEN="$(vault read -field secret_id nomad/creds/developer)"
  CONSUL_HTTP_TOKEN="$(vault read -field token consul/creds/developer)"
  export NOMAD_TOKEN
  export CONSUL_HTTP_TOKEN
fi
